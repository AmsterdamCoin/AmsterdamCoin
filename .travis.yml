language: csharp
mono: none
dotnet: 1.0.4
matrix:
  include:
  - os: linux # Ubuntu 14.04
    dist: trusty
    sudo: required      
  - os: osx # OSX 10.11
    osx_image: xcode7.3      
  - os: osx # OSX 10.12
    osx_image: xcode8.1      

# branches to build 
branches:
  only:
  - master

env:
    global: 
    - log_prefix="[$TRAVIS_OS_NAME]"
    - arch=x64
    - configuration="Release"
    - app_output_name="breeze-$arch-$TRAVIS_OS_NAME-Release"
    - api_output_name="api-$arch-$TRAVIS_OS_NAME-Release"
    - os_platform=linux
    - TRAVIS_TAG=cd-unstable

# Work around NuGet issue #2163
# https://github.com/NuGet/Home/issues/2163
# https://github.com/travis-ci/travis-ci/issues/7728
before_install:    
  - if [ "$TRAVIS_OS_NAME" = "osx" ]; then ulimit -n 1024; $os_platform=darwin; fi

install:
  - nvm install 6
script:
  - chmod +x build.sh
  - ./build.sh

deploy:
  provider: releases
  api_key: 
  - secure: fRWMdtlr1+V4NsC2C2lOsUM553XtWjC+ohJ+SF9uq7Vqi68x1ugGUh4m3Re/Pd8OiFpBGEv0EWyDRCtsj12BpZLB2XYmggRkYgcfK6AxWMB+yqhzYExfjhmenVPVC0thI+XDcr9/GELr2jpETPjkZEL+w2KmQFA23Mg0f0FIeBYpSibBLJ12kQt7BBDDPS1g17tFd3YYK4LTJ/XFFu4jyFjaXYh2WumpZ6YsVQb4rxsYEkQgL5e0xiWl94KiT8TOGx0OodQNC9k274MZuj97IiP5ghFWiEpls0QsvPkPw1MzNbf20O92aTdk9x38qrvEFBN7O6Es5oTnYtNQToTAT9o3Pdq5bsnEJKad7evzoUp2FSHHQZOcYd/f4oLwMeCSjv3XV3exoegDpTgil8i2SUVZ+ov6y4qQZV+n9kVIZ71ep8+KEVNBdMRspsr6/wIJXjmJmRSF5SN+gsf0Jwx+525T3YszuVREfsnRRdBVDcZEWVGsaVVlqWCHDm5/9vNf/wC78F7oiYiTP/1GTaNCEZjgkYccCotQGn2SzGSkx19aaJHmp4Vp/27VCJsD4eSFjiYoVotS1D4Z+dHAkDu5f0KeAIRoFq2JsG6suvdx3cbSE7kN0gQPAVbLg0nXBxq7iDEHf4a5gjK6VIJQWIr2iJ4JB+6Idih7/T5InTrSZv4=
  file_glob: true
  file: $TRAVIS_BUILD_DIR/deploy/*.zip
  skip_cleanup: true
  overwrite: true
  prerelease: true
  on:
    branch: master
    tags: true